parameters:
  artifactName: ''
  sandboxJobName: ''
  appFile: ''
  appName: ''
  devices: ''

jobs:
- job: appCenterTests_${{ parameters.sandboxJobName }}
  displayName: App Center Tests ${{ parameters.appName }}
  dependsOn:
  - ${{ parameters.sandboxJobName }}
  - xamarinUITest
  pool:
    vmImage: $(VMImage)
    demands:
    - MSBuild
  workspace:
    clean: all
  steps:
  - task: DownloadPipelineArtifact@2
    displayName: Download UI Test Project
    inputs:
      artifactName: XamarinUITests
      targetPath: '$(Pipeline.Workspace)/XamarinUITests/'
  - task: DownloadPipelineArtifact@2
    displayName: Download ${{ parameters.artifactName }}
    inputs:
      artifactName: ${{ parameters.artifactName }}
      targetPath: '$(Pipeline.Workspace)/${{ parameters.artifactName }}/'

  - powershell: |
     Write-Host "Pipeline Workspace: $($env:PIPELINE_WORKSPACE)"
     cd $env:PIPELINE_WORKSPACE
     Get-ChildItem . -Recurse | ForEach-Object -Process { $_.FullName }
    displayName: List Artifacts

  - task: AppCenterTest@1
    displayName: 'Run UI Tests ${{ parameters.artifactName }} with App Center'
    inputs:
      appFile: ${{ parameters.artifactName }}/${{ parameters.appFile }}
      frameworkOption: uitest
      uiTestBuildDirectory: $(Pipeline.Workspace)/XamarinUITests/
      serverEndpoint: 'Prism-AppCenter'
      appSlug: 'Prism/${{ parameters.appName }}'
      devices: ${{ parameters.devices }}
