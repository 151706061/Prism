parameters:
  appName: ''
  appFile: ''
  symbolsDsymFiles: ''
  distributionGroup: ''

steps:
- powershell: |
    $BuildReleaseNotes="# Build $env:BUILD_BUILDID`n`nBuild Reason: $env:BUILD_REASON`nSource Branch: $env:BUILD_SOURCEBRANCH`n`n"

    if($env:SYSTEM_PULLREQUEST_PULLREQUESTNUMBER -ne '')
    {
      $BuildReleaseNotes+="## Pull Request Info`n`nPR: #$env:SYSTEM_PULLREQUEST_PULLREQUESTNUMBER`nSource Branch: $env:SYSTEM_PULLREQUEST_SOURCEBRANCH`n`n"
    }

    if($env:IS_PREVIEW -eq $true)
    {
      $BuildReleaseNotes+="Built for Official Preview Release`n`n"
    }
    else if($env:IS_RELEASE -eq $true)
    {
      $BuildReleaseNotes+="Built for Official GA/Service Release`n`n"
    }

    $BuildReleaseNotes+="## Version Message`n`n$env:BUILD_SOURCEVERSIONMESSAGE"
    Write-Host $BuildReleaseNotes
    Write-Output ("##vso[task.setvariable variable=BuildReleaseNotes;]$BuildReleaseNotes")
  displayName: Set Variables for App Center Deploy

- task: AppCenterDistribute@3
  displayName: 'Deploy ${{ parameters.appName }} App to App Center'
  inputs:
    serverEndpoint: Prism-AppCenter
    appSlug: 'Prism/${{ parameters.appName }}'
    appFile: ${{ parameters.appFile }}
    symbolsDsymFiles: ${{ parameters.symbolsDsymFiles }}
    symbolsIncludeParentDirectory: false
    releaseNotesInput: $(BuildReleaseNotes)
    distributionGroupId: ${{ parameters.distributionGroup }}
    isSilent: false